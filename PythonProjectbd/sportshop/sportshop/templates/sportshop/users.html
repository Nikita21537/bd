<!-- sportshop/templates/sportshop/users.html -->
{% extends 'sportshop/base.html' %}

{% block content %}
<div class="admin-container">
    <!-- Боковая панель админа -->
    <div class="admin-sidebar">
        <div class="admin-user-info">
            <div class="admin-user-avatar">
                {{ user.username|first|upper }}
            </div>
            <div class="admin-user-details">
                <h4>{{ user.username }}</h4>
                <p class="user-role">
                    {% if user.is_superuser %}
                    Суперадминистратор
                    {% elif 'administrator' in user_groups %}
                    Администратор
                    {% elif 'manager' in user_groups %}
                    Менеджер
                    {% else %}
                    Пользователь
                    {% endif %}
                </p>
            </div>
        </div>

        <ul class="admin-menu">
            <li><a href="{% url 'admin_dashboard' %}">
                <i class="fas fa-tachometer-alt"></i> Дашборд
            </a></li>
            <li><a href="{% url 'admin_products' %}">
                <i class="fas fa-box"></i> Товары
            </a></li>
            <li><a href="{% url 'admin_orders' %}">
                <i class="fas fa-shopping-cart"></i> Заказы
            </a></li>
            <li><a href="{% url 'admin_order_history' %}">
                <i class="fas fa-history"></i> История заказов
            </a></li>
            <li><a href="{% url 'admin_users' %}" class="active">
                <i class="fas fa-users"></i> Пользователи
            </a></li>
            <li><a href="{% url 'customer_account' %}">
                <i class="fas fa-user"></i> Личный кабинет
            </a></li>
            <li><a href="{% url 'home' %}">
                <i class="fas fa-home"></i> На сайт
            </a></li>
        </ul>
    </div>

    <!-- Основной контент -->
    <div class="admin-content">
        <div class="admin-header">
            <div class="header-left">
                <h1>Управление пользователями</h1>
                <p>Всего пользователей: {{ total_users }}</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="showAddUserModal()">
                    <i class="fas fa-user-plus"></i> Добавить пользователя
                </button>
                <button class="btn btn-outline">
                    <i class="fas fa-file-export"></i> Экспорт
                </button>
            </div>
        </div>

        <!-- Фильтры и поиск -->
        <div class="filters-section">
            <form method="get" class="filters-form">
                <div class="filter-row">
                    <div class="filter-group">
                        <input type="text" name="q" placeholder="Поиск по имени, email..."
                               value="{{ request.GET.q|default:'' }}" class="search-input">
                    </div>

                    <div class="filter-group">
                        <select name="group" class="filter-select">
                            <option value="all">Все группы</option>
                            {% for group in groups %}
                            <option value="{{ group.id }}"
                                    {% if request.GET.group == group.id|stringformat:'i' %}selected{% endif %}>
                                {{ group.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <select name="is_active" class="filter-select">
                            <option value="all">Все статусы</option>
                            <option value="true" {% if request.GET.is_active == 'true' %}selected{% endif %}>Активные</option>
                            <option value="false" {% if request.GET.is_active == 'false' %}selected{% endif %}>Неактивные</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Найти
                        </button>
                        <a href="{% url 'admin_users' %}" class="btn btn-outline">
                            Сбросить
                        </a>
                    </div>
                </div>
            </form>
        </div>

        <!-- Таблица пользователей -->
        <div class="table-section">
            <div class="table-responsive">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th width="60">ID</th>
                            <th>Пользователь</th>
                            <th width="120">Роль</th>
                            <th width="120">Статус</th>
                            <th width="120">Заказов</th>
                            <th width="150">Дата регистрации</th>
                            <th width="180">Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user_item in users %}
                        <tr>
                            <td>{{ user_item.id }}</td>
                            <td>
                                <div class="user-info-cell">
                                    <div class="user-avatar-table">
                                        {{ user_item.username|first|upper }}
                                    </div>
                                    <div class="user-details-table">
                                        <strong>{{ user_item.username }}</strong>
                                        <div class="user-email">
                                            {{ user_item.email|default:"Email не указан" }}
                                        </div>
                                        <div class="user-name">
                                            {% if user_item.first_name or user_item.last_name %}
                                            {{ user_item.first_name }} {{ user_item.last_name }}
                                            {% else %}
                                            Имя не указано
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="user-roles">
                                    {% for group in user_item.groups.all %}
                                    <span class="role-badge role-{{ group.name|lower }}">
                                        {{ group.name }}
                                    </span>
                                    {% empty %}
                                    <span class="role-badge role-none">Без роли</span>
                                    {% endfor %}
                                    {% if user_item.is_superuser %}
                                    <span class="role-badge role-superuser">Суперпользователь</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                {% if user_item.is_active %}
                                <span class="status-badge status-active">
                                    <i class="fas fa-check-circle"></i> Активен
                                </span>
                                {% else %}
                                <span class="status-badge status-inactive">
                                    <i class="fas fa-times-circle"></i> Неактивен
                                </span>
                                {% endif %}
                                <br>
                                <small class="status-text">
                                    {% if user_item.is_staff %}
                                    <i class="fas fa-shield-alt"></i> Персонал
                                    {% endif %}
                                </small>
                            </td>
                            <td>
                                <div class="user-stats">
                                    <div class="orders-count">
                                        {{ user_item.orders.count|default:"0" }}
                                    </div>
                                    <div class="orders-total">
                                        <small>{{ user_item.profile.total_spent|default:"0" }} ₽</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="registration-date">
                                    <div>{{ user_item.date_joined|date:"d.m.Y" }}</div>
                                    <small>{{ user_item.date_joined|date:"H:i" }}</small>
                                </div>
                                {% if user_item.last_login %}
                                <div class="last-login">
                                    <small>Был: {{ user_item.last_login|timesince }} назад</small>
                                </div>
                                {% endif %}
                            </td>
                            <td>
                                <div class="user-actions">
                                    <button class="btn-action btn-view"
                                            onclick="viewUserProfile({{ user_item.id }})"
                                            title="Профиль">
                                        <i class="fas fa-user"></i>
                                    </button>

                                    <button class="btn-action btn-edit"
                                            onclick="editUser({{ user_item.id }})"
                                            title="Редактировать">
                                        <i class="fas fa-edit"></i>
                                    </button>

                                    <div class="dropdown">
                                        <button class="btn-action btn-more dropdown-toggle"
                                                title="Управление ролями">
                                            <i class="fas fa-user-tag"></i>
                                        </button>
                                        <div class="dropdown-menu">
                                            <h6>Изменить роль:</h6>
                                            {% for group in groups %}
                                            <label class="dropdown-item">
                                                <input type="checkbox"
                                                       {% if group in user_item.groups.all %}checked{% endif %}
                                                       onchange="toggleUserGroup({{ user_item.id }}, {{ group.id }}, this.checked)">
                                                <span class="role-dot role-{{ group.name|lower }}"></span>
                                                {{ group.name }}
                                            </label>
                                            {% endfor %}
                                            <div class="dropdown-divider"></div>
                                            <a href="#" class="dropdown-item"
                                               onclick="resetPassword({{ user_item.id }})">
                                                <i class="fas fa-key"></i> Сбросить пароль
                                            </a>
                                            {% if user_item.is_active %}
                                            <a href="#" class="dropdown-item text-warning"
                                               onclick="deactivateUser({{ user_item.id }}, '{{ user_item.username }}')">
                                                <i class="fas fa-user-slash"></i> Деактивировать
                                            </a>
                                            {% else %}
                                            <a href="#" class="dropdown-item text-success"
                                               onclick="activateUser({{ user_item.id }}, '{{ user_item.username }}')">
                                                <i class="fas fa-user-check"></i> Активировать
                                            </a>
                                            {% endif %}
                                            <a href="#" class="dropdown-item text-danger"
                                               onclick="deleteUser({{ user_item.id }}, '{{ user_item.username }}')">
                                                <i class="fas fa-trash"></i> Удалить
                                            </a>
                                        </div>
                                    </div>

                                    <button class="btn btn-small btn-outline"
                                            onclick="impersonateUser({{ user_item.id }})">
                                        <i class="fas fa-sign-in-alt"></i> Войти как
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <h3>Пользователи не найдены</h3>
                                    <p>Попробуйте изменить параметры поиска</p>
                                    <button class="btn btn-primary" onclick="showAddUserModal()">
                                        <i class="fas fa-user-plus"></i> Добавить пользователя
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Пагинация -->
            {% if users.has_other_pages %}
            <div class="pagination-wrapper">
                <div class="pagination-info">
                    Показано {{ users.start_index }} - {{ users.end_index }} из {{ users.paginator.count }}
                </div>
                <div class="pagination">
                    {% if users.has_previous %}
                    <a href="?page={{ users.previous_page_number }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                       class="page-link">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                    {% endif %}

                    {% for num in users.paginator.page_range %}
                        {% if users.number == num %}
                        <span class="page-current">{{ num }}</span>
                        {% elif num > users.number|add:'-3' and num < users.number|add:'3' %}
                        <a href="?page={{ num }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                           class="page-link">{{ num }}</a>
                        {% endif %}
                    {% endfor %}

                    {% if users.has_next %}
                    <a href="?page={{ users.next_page_number }}{% for key,value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                       class="page-link">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Модальное окно добавления/редактирования пользователя -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Добавить пользователя</h3>
            <button class="modal-close" onclick="closeUserModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="userFormContainer">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Загрузка формы...
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно профиля пользователя -->
<div id="profileModal" class="modal profile-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Профиль пользователя</h3>
            <button class="modal-close" onclick="closeProfileModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="profileContainer">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Загрузка профиля...
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Основные стили из предыдущих шаблонов */

/* Специфичные стили для страницы пользователей */
.user-info-cell {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-avatar-table {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 18px;
    flex-shrink: 0;
}

.user-details-table {
    flex: 1;
}

.user-details-table strong {
    display: block;
    margin-bottom: 4px;
    font-size: 15px;
    color: #333;
}

.user-email {
    font-size: 13px;
    color: #666;
    margin-bottom: 3px;
    word-break: break-all;
}

.user-name {
    font-size: 12px;
    color: #888;
}

.user-roles {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.role-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-align: center;
}

.role-customer { background: #cfe2ff; color: #084298; }
.role-manager { background: #d1ecf1; color: #0c5460; }
.role-administrator { background: #d4edda; color: #155724; }
.role-superuser { background: #f8d7da; color: #721c24; }
.role-none { background: #e2e3e5; color: #383d41; }

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    margin-bottom: 5px;
}

.status-active { background: #d4edda; color: #155724; }
.status-inactive { background: #f8d7da; color: #721c24; }

.status-text {
    color: #888;
    font-size: 11px;
    display: block;
}

.user-stats {
    text-align: center;
}

.orders-count {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 3px;
}

.orders-total small {
    color: #888;
    font-size: 11px;
}

.registration-date {
    font-size: 14px;
    color: #333;
    margin-bottom: 5px;
}

.registration-date small {
    color: #888;
    font-size: 12px;
    display: block;
}

.last-login small {
    color: #666;
    font-size: 11px;
}

.user-actions {
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-action {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 14px;
}

.btn-view {
    background: #e9ecef;
    color: #495057;
}

.btn-view:hover {
    background: #495057;
    color: white;
}

.btn-edit {
    background: #cfe2ff;
    color: #084298;
}

.btn-edit:hover {
    background: #084298;
    color: white;
}

.btn-more {
    background: #f8f9fa;
    color: #6c757d;
}

.btn-more:hover {
    background: #6c757d;
    color: white;
}

.dropdown-menu h6 {
    padding: 8px 15px;
    margin: 0;
    font-size: 12px;
    font-weight: 600;
    color: #666;
    text-transform: uppercase;
}

.dropdown-item label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    width: 100%;
    margin: 0;
    padding: 8px 15px;
}

.dropdown-item label:hover {
    background: #f8f9fa;
}

.dropdown-item input[type="checkbox"] {
    margin: 0;
}

.role-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
}

.text-warning { color: #ffc107 !important; }
.text-success { color: #28a745 !important; }
.text-danger { color: #dc3545 !important; }

/* Модальное окно профиля */
.profile-modal .modal-content {
    max-width: 600px;
}

/* Адаптивность */
@media (max-width: 1200px) {
    .admin-container {
        grid-template-columns: 1fr;
    }

    .admin-sidebar {
        margin-bottom: 30px;
    }
}

@media (max-width: 992px) {
    .users-table {
        display: block;
        overflow-x: auto;
    }

    .user-actions {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
}

@media (max-width: 768px) {
    .admin-header {
        flex-direction: column;
        gap: 15px;
    }

    .header-actions {
        width: 100%;
        justify-content: flex-start;
    }

    .filter-row {
        flex-direction: column;
    }

    .filter-group {
        min-width: 100%;
    }
}
</style>

<script>
// Функции для работы с пользователями
function showAddUserModal() {
    const modal = document.getElementById('userModal');
    const container = document.getElementById('userFormContainer');

    container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Загрузка формы...</div>';

    fetch('/admin/users/add/')  // Нужно будет создать этот URL
        .then(response => response.text())
        .then(html => {
            container.innerHTML = html;
            modal.style.display = 'flex';
        })
        .catch(error => {
            container.innerHTML = '<div class="error">Ошибка загрузки формы</div>';
        });
}

function closeUserModal() {
    document.getElementById('userModal').style.display = 'none';
}

function viewUserProfile(userId) {
    const modal = document.getElementById('profileModal');
    const container = document.getElementById('profileContainer');

    container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Загрузка профиля...</div>';

    fetch(`/admin/users/${userId}/profile/`)  // Нужно будет создать этот URL
        .then(response => response.json())
        .then(data => {
            container.innerHTML = renderUserProfile(data);
            modal.style.display = 'flex';
        })
        .catch(error => {
            container.innerHTML = '<div class="error">Ошибка загрузки профиля</div>';
        });
}

function closeProfileModal() {
    document.getElementById('profileModal').style.display = 'none';
}

function editUser(userId) {
    const modal = document.getElementById('userModal');
    const container = document.getElementById('userFormContainer');

    container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Загрузка формы...</div>';

    fetch(`/admin/users/${userId}/edit/`)  // Нужно будет создать этот URL
        .then(response => response.text())
        .then(html => {
            container.innerHTML = html;
            modal.style.display = 'flex';
        })
        .catch(error => {
            container.innerHTML = '<div class="error">Ошибка загрузки формы</div>';
        });
}

function toggleUserGroup(userId, groupId, checked) {
    const action = checked ? 'add' : 'remove';

    fetch(`/admin/users/${userId}/group/`, {  // Нужно будет создать этот URL
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            group_id: groupId,
            action: action
        })
    })
    .then(response => response.json())
    .then(data => {
        if (!data.success) {
            alert('Ошибка при изменении роли');
            location.reload();
        }
    })
    .catch(error => {
        alert('Ошибка соединения');
        location.reload();
    });
}

function resetPassword(userId) {
    if (confirm('Отправить ссылку для сброса пароля на email пользователя?')) {
        fetch(`/admin/users/${userId}/reset-password/`, {  // Нужно будет создать этот URL
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Ссылка для сброса пароля отправлена');
            } else {
                alert('Ошибка при отправке ссылки');
            }
        })
        .catch(error => {
            alert('Ошибка соединения');
        });
    }
}

function deactivateUser(userId, username) {
    if (confirm(`Деактивировать пользователя "${username}"?`)) {
        updateUserStatus(userId, false);
    }
}

function activateUser(userId, username) {
    if (confirm(`Активировать пользователя "${username}"?`)) {
        updateUserStatus(userId, true);
    }
}

function deleteUser(userId, username) {
    if (confirm(`Удалить пользователя "${username}"? Это действие нельзя отменить.`)) {
        fetch(`/admin/users/${userId}/delete/`, {  // Нужно будет создать этот URL
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Пользователь удален');
                location.reload();
            } else {
                alert('Ошибка при удалении пользователя');
            }
        })
        .catch(error => {
            alert('Ошибка соединения');
        });
    }
}

function impersonateUser(userId) {
    if (confirm('Войти как этот пользователь? Вы выйдете из текущей учетной записи.')) {
        fetch(`/admin/users/${userId}/impersonate/`, {  // Нужно будет создать этот URL
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = '/';
            } else {
                alert('Ошибка при входе как пользователь');
            }
        })
        .catch(error => {
            alert('Ошибка соединения');
        });
    }
}

function updateUserStatus(userId, isActive) {
    fetch(`/admin/users/${userId}/status/`, {  // Нужно будет создать этот URL
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ is_active: isActive })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Ошибка при изменении статуса');
        }
    })
    .catch(error => {
        alert('Ошибка соединения');
    });
}

// Вспомогательная функция для отображения профиля
function renderUserProfile(data) {
    return `
        <div class="user-profile">
            <div class="profile-header">
                <div class="profile-avatar-large">
                    ${data.username[0].toUpperCase()}
                </div>
                <div class="profile-info">
                    <h4>${data.username}</h4>
                    <p>${data.email || 'Email не указан'}</p>
                    <div class="profile-roles">
                        ${data.groups.map(group => `
                            <span class="role-badge role-${group.name.toLowerCase()}">${group.name}</span>
                        `).join('')}
                        ${data.is_superuser ? '<span class="role-badge role-superuser">Суперпользователь</span>' : ''}
                    </div>
                </div>
            </div>

            <div class="profile-details">
                <div class="details-section">
                    <h5>Личная информация</h5>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Имя:</span>
                            <span class="detail-value">${data.first_name || 'Не указано'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Фамилия:</span>
                            <span class="detail-value">${data.last_name || 'Не указано'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Дата регистрации:</span>
                            <span class="detail-value">${data.date_joined}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Последний вход:</span>
                            <span class="detail-value">${data.last_login || 'Никогда'}</span>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <h5>Статистика</h5>
                    <div class="stats-grid">
                        <div class="stat-card-small">
                            <div class="stat-icon-small">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div class="stat-info-small">
                                <h6>${data.orders_count || 0}</h6>
                                <p>Заказов</p>
                            </div>
                        </div>
                        <div class="stat-card-small">
                            <div class="stat-icon-small">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-info-small">
                                <h6>${data.total_spent || 0} ₽</h6>
                                <p>Потрачено</p>
                            </div>
                        </div>
                        <div class="stat-card-small">
                            <div class="stat-icon-small">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-info-small">
                                <h6>${data.bonus_points || 0}</h6>
                                <p>Бонусов</p>
                            </div>
                        </div>
                        <div class="stat-card-small">
                            <div class="stat-icon-small">
                                <i class="fas fa-comment"></i>
                            </div>
                            <div class="stat-info-small">
                                <h6>${data.reviews_count || 0}</h6>
                                <p>Отзывов</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <h5>Последние заказы</h5>
                    ${data.recent_orders && data.recent_orders.length > 0 ? `
                        <div class="recent-orders">
                            ${data.recent_orders.map(order => `
                                <div class="order-item-small">
                                    <div class="order-number">#${order.number}</div>
                                    <div class="order-date">${order.date}</div>
                                    <div class="order-amount">${order.amount} ₽</div>
                                    <div class="order-status status-${order.status}">${order.status_display}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p>Заказов нет</p>'}
                </div>
            </div>
        </div>
    `;
}

// Вспомогательная функция для получения CSRF токена
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Закрытие модальных окон при клике вне их
window.onclick = function(event) {
    const userModal = document.getElementById('userModal');
    const profileModal = document.getElementById('profileModal');

    if (event.target == userModal) {
        closeUserModal();
    }
    if (event.target == profileModal) {
        closeProfileModal();
    }
}
</script>
{% endblock %}